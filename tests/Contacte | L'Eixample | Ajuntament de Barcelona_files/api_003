
define([geoBCN.baseFiles+"utils"+geoBCN.suffix+".js"],function(Utils){var log=geoBCN.log4js.getLogger("cercadors");log.addAppender(geoBCN.logAppender);log.debug("init module");var hashRequests={};function consultaServeiWeb(url,campsConsulta,opcions){try{if(opcions.nomesCamps){campsConsulta.nomescamps=opcions.nomesCamps.join(",");}
if(opcions.extensio){campsConsulta.extensio=opcions.extensio;}
if(opcions.geometria){campsConsulta.geometria=opcions.geometria;}
if(hashRequests[url]){hashRequests[url].abort();}
hashRequests[url]=Utils.rest(geoBCN.serviceURL+url,campsConsulta,opcions.resultat);}catch(e){log.error("Error en la consulta web",e);}}
function revGeocodingADR(opcions){consultaServeiWeb('/territori/adreces',{x:opcions.x,y:opcions.y,max:opcions.max,proj:opcions.proj,radi:opcions.radi,parcellaId:opcions.parcellaId,geometria:true,extensio:true},opcions);}
function revGeocodingPAR(opcions){consultaServeiWeb("/territori/parcelles",{x:opcions.x,y:opcions.y,proj:opcions.proj,geometria:true,extensio:true},opcions);}
function cercaRefCatPar(opcions){consultaServeiWeb("/territori/parcelles",{"rc":opcions.rc},opcions);}
function cercaFullsMil(opcions){consultaServeiWeb("/territori/fulls1000/"+opcions.codi,{},opcions);}
function cercaTipusVia(opcions){consultaServeiWeb("/territori/tipusvies",{"nom":opcions.nom},opcions);}
function cercaCarrers(opcions){consultaServeiWeb("/territori/vies",{nom:opcions.nom,id_tipus_via:opcions.id_tipus_via},opcions);}
function cercaUnificada(opcions){consultaServeiWeb("/territori",{q:opcions.q},opcions);}
function cercaPortals(opcions){consultaServeiWeb("/territori/portals",{id_via:opcions.id_via,numero:opcions.numero},opcions);}
function cercaCruilles(opcions){consultaServeiWeb("/territori/cruilles",{id_via:opcions.id_via,nom:opcions.nom},opcions);}
function cercaBarris(opcions){consultaServeiWeb("/territori/barris",{"nom":opcions.nom},opcions);}
function cercaDistrictes(opcions){consultaServeiWeb("/territori/districtes",{"nom":opcions.nom},opcions);}
function cercaSecCensal(opcions){consultaServeiWeb("/territori/seccionscensals",{"codi":opcions.codi},opcions);}
function cercaIlles(opcions){consultaServeiWeb("/territori/illes",{"codi":opcions.codi},opcions);}
return{revGeocodingAdr:function(opcions){log.debug("Reverse geocoding Adreça:"+opcions.x+" - "+opcions.y);try{revGeocodingADR(opcions);}catch(e){log.error("Error en la cerca",e);}},revGeocodingPar:function(opcions){log.debug("Reverse geocoding Parcel·la:"+opcions.x+" - "+opcions.y);try{revGeocodingPAR(opcions);}catch(e){log.error("Error en la cerca",e);}},cercaTipusVia:function(opcions){log.debug("Executa cerca de tipus de via");try{cercaTipusVia(opcions);}catch(e){log.error("Error en la cerca",e);}},cercaCarrers:function(opcions){log.debug("Executa cerca de carrers");try{cercaCarrers(opcions);}catch(e){log.error("Error en la cerca",e);}},cercaUnificada:function(opcions){log.debug("Executa cerca unificada");try{cercaUnificada(opcions);}catch(e){log.error("Error en la cerca unificada",e);}},cercaRefCatPar:function(opcions){log.debug("Executa cerca de parcelles per rc");try{cercaRefCatPar(opcions);}catch(e){log.error("Error en la cerca",e);}},cercaFullsMil:function(opcions){log.debug("Executa cerca de fulls 1:1000");try{cercaFullsMil(opcions);}catch(e){log.error("Error en la cerca",e);}},cercaPortals:function(opcions){log.debug("Executa cerca de portals");try{cercaPortals(opcions);}catch(e){log.error("Error en la cerca",e);}},cercaCruilles:function(opcions){log.debug("Executant cerca de cruïlles");try{cercaCruilles(opcions);}catch(e){log.error("Error en la cerca",e);}},cercaBarris:function(opcions){log.debug("Executant cerca de barris");try{cercaBarris(opcions);}catch(e){log.error("Error en la cerca de barris",e);}},cercaDistrictes:function(opcions){log.debug("Executant cerca de districtes");try{cercaDistrictes(opcions);}catch(e){log.error("Error en la cerca de districtes",e);}},cercaSecCensal:function(opcions){log.debug("Executant cerca de Seccions censals");try{cercaSecCensal(opcions);}catch(e){log.error("Error en la cerca de Seccions censals",e);}},cercaIlles:function(opcions){log.debug("Executant cerca d'illes");try{cercaIlles(opcions);}catch(e){log.error("Error en la cerca d'illes",e);}}}});